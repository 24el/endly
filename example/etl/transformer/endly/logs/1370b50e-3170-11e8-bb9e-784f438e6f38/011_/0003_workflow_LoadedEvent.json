{
	"Workflow": {
		"Source": {
			"URL": "mem://github.com/viant/endly/workflow/app/build/build.csv",
			"Credentials": "",
			"Cache": "",
			"CacheExpiryMs": 0
		},
		"Data": null,
		"Name": "build",
		"Description": "Build go app in linux docker container with custom dependencies",
		"Init": [
			{
				"Name": "app",
				"Value": null,
				"From": "params.app",
				"When": "",
				"Else": null,
				"Persist": false,
				"Required": true,
				"Replace": null
			},
			{
				"Name": "origin",
				"Value": null,
				"From": "params.origin",
				"When": "",
				"Else": null,
				"Persist": false,
				"Required": true,
				"Replace": null
			},
			{
				"Name": "replace",
				"Value": {},
				"From": "params.replace",
				"When": "",
				"Else": null,
				"Persist": false,
				"Required": true,
				"Replace": null
			},
			{
				"Name": "expand",
				"Value": true,
				"From": "params.expand",
				"When": "",
				"Else": null,
				"Persist": false,
				"Required": true,
				"Replace": null
			},
			{
				"Name": "upload",
				"Value": [],
				"From": "params.upload",
				"When": "",
				"Else": null,
				"Persist": false,
				"Required": true,
				"Replace": null
			},
			{
				"Name": "download",
				"Value": [],
				"From": "params.download",
				"When": "",
				"Else": null,
				"Persist": false,
				"Required": true,
				"Replace": null
			},
			{
				"Name": "init",
				"Value": [
					"mkdir -p $buildPath",
					"chmod +x $buildPath",
					"chown $os.user  $buildPath"
				],
				"From": "params.init",
				"When": "",
				"Else": null,
				"Persist": false,
				"Required": true,
				"Replace": null
			},
			{
				"Name": "superUser",
				"Value": false,
				"From": "",
				"When": "",
				"Else": null,
				"Persist": false,
				"Required": true,
				"Replace": null
			},
			{
				"Name": "commands",
				"Value": null,
				"From": "params.commands",
				"When": "",
				"Else": null,
				"Persist": false,
				"Required": true,
				"Replace": null
			},
			{
				"Name": "buildPath",
				"Value": "/tmp/${app}/build/",
				"From": "params.buildPath",
				"When": "",
				"Else": null,
				"Persist": false,
				"Required": true,
				"Replace": null
			},
			{
				"Name": "releasePath",
				"Value": "/tmp/${app}/release/",
				"From": "params.buildRoot",
				"When": "",
				"Else": null,
				"Persist": false,
				"Required": true,
				"Replace": null
			},
			{
				"Name": "target",
				"Value": {
					"Credentials": "localhost",
					"URL": "ssh://127.0.0.1/"
				},
				"From": "params.target",
				"When": "",
				"Else": null,
				"Persist": false,
				"Required": false,
				"Replace": null
			},
			{
				"Name": "buildTarget",
				"Value": "$target",
				"From": "",
				"When": "",
				"Else": null,
				"Persist": false,
				"Required": true,
				"Replace": null
			},
			{
				"Name": "buildTarget",
				"Value": {
					"Credentials": "$buildTarget.Credentials",
					"URL": "$URLJoin([\"$buildTarget.URL\",\"$buildPath\"])"
				},
				"From": "",
				"When": "",
				"Else": null,
				"Persist": false,
				"Required": false,
				"Replace": null
			}
		],
		"Post": null,
		"Tasks": [
			{
				"When": "",
				"Seq": 0,
				"Name": "start SSHD docker",
				"Description": "Run an docker",
				"Actions": [
					{
						"Service": "exec",
						"Action": "run",
						"Request": {
							"commands": "$init",
							"superUser": "$superUser",
							"target": "$buildTarget",
							"timeoutMs": 40000
						},
						"Description": "create base app dir",
						"Tag": "Init",
						"TagIndex": "",
						"TagID": "build_Init",
						"TagDescription": "",
						"Extraction": null,
						"Variables": null,
						"Repeat": 1,
						"SleepTimeMs": 0,
						"Exit": "",
						"Name": "",
						"Init": null,
						"Post": null,
						"Async": false,
						"When": "",
						"Skip": ""
					}
				],
				"Init": null,
				"Post": null,
				"TimeSpentMs": 0
			},
			{
				"When": "",
				"Seq": 0,
				"Name": "build",
				"Description": "Run an action",
				"Actions": [
					{
						"Service": "sdk",
						"Action": "set",
						"Request": {
							"sdk": "$sdk",
							"target": "$buildTarget"
						},
						"Description": "set sdk",
						"Tag": "Build",
						"TagIndex": "",
						"TagID": "build_Build",
						"TagDescription": "",
						"Extraction": null,
						"Variables": null,
						"Repeat": 1,
						"SleepTimeMs": 0,
						"Exit": "",
						"Name": "",
						"Init": null,
						"Post": null,
						"Async": false,
						"When": "$Length($init) \u003e 0",
						"Skip": ""
					},
					{
						"Service": "version/control",
						"Action": "checkout",
						"Request": {
							"dest": "$buildTarget",
							"origin": "$origin"
						},
						"Description": "checkout code",
						"Tag": "Build",
						"TagIndex": "",
						"TagID": "build_Build",
						"TagDescription": "",
						"Extraction": null,
						"Variables": null,
						"Repeat": 1,
						"SleepTimeMs": 0,
						"Exit": "",
						"Name": "",
						"Init": null,
						"Post": null,
						"Async": false,
						"When": "$origin",
						"Skip": ""
					},
					{
						"Service": "storage",
						"Action": "copy",
						"Request": {
							"assets": "$upload",
							"dest": "$buildTarget",
							"expand": "$expand",
							"replace": "$replace",
							"source": "$target"
						},
						"Description": "upload custom assets",
						"Tag": "Build",
						"TagIndex": "",
						"TagID": "build_Build",
						"TagDescription": "",
						"Extraction": null,
						"Variables": null,
						"Repeat": 1,
						"SleepTimeMs": 0,
						"Exit": "",
						"Name": "",
						"Init": null,
						"Post": null,
						"Async": false,
						"When": "$Length($upload) \u003e 0",
						"Skip": ""
					},
					{
						"Service": "exec",
						"Action": "run",
						"Request": {
							"commands": "$commands",
							"errors": [
								"Error",
								"command not found",
								"imported and not used",
								"in single-value context",
								"cannot use",
								"can't load package",
								"exit status 1",
								"executable file not found"
							],
							"superUser": "$superUser",
							"target": "$buildTarget",
							"timeoutMs": 60000
						},
						"Description": "run commands",
						"Tag": "Build",
						"TagIndex": "",
						"TagID": "build_Build",
						"TagDescription": "",
						"Extraction": null,
						"Variables": null,
						"Repeat": 1,
						"SleepTimeMs": 0,
						"Exit": "",
						"Name": "",
						"Init": null,
						"Post": null,
						"Async": false,
						"When": "",
						"Skip": ""
					},
					{
						"Service": "storage",
						"Action": "copy",
						"Request": {
							"assets": "$download",
							"dest": "$target",
							"expand": "$expand",
							"replace": "$replace",
							"source": "$buildTarget"
						},
						"Description": "download custom assets",
						"Tag": "Build",
						"TagIndex": "",
						"TagID": "build_Build",
						"TagDescription": "",
						"Extraction": null,
						"Variables": null,
						"Repeat": 1,
						"SleepTimeMs": 0,
						"Exit": "",
						"Name": "",
						"Init": null,
						"Post": null,
						"Async": false,
						"When": "$Length($download) \u003e 0",
						"Skip": ""
					}
				],
				"Init": null,
				"Post": null,
				"TimeSpentMs": 0
			}
		],
		"OnErrorTask": "",
		"DeferTask": "",
		"SleepTimeMs": 0
	}
}