{
	"Workflow": {
		"Source": {
			"URL": "mem://github.com/viant/endly/workflow/app/deploy/deploy.csv",
			"Credentials": "",
			"Cache": "",
			"CacheExpiryMs": 0
		},
		"Data": null,
		"Name": "deploy",
		"Description": "deploy app",
		"Init": [
			{
				"Name": "appRoot",
				"Value": "/opt/",
				"From": "params.appRoot",
				"When": "",
				"Else": null,
				"Persist": false,
				"Required": true,
				"Replace": null
			},
			{
				"Name": "app",
				"Value": null,
				"From": "params.app",
				"When": "",
				"Else": null,
				"Persist": false,
				"Required": true,
				"Replace": null
			},
			{
				"Name": "upload",
				"Value": [],
				"From": "params.upload",
				"When": "",
				"Else": null,
				"Persist": false,
				"Required": true,
				"Replace": null
			},
			{
				"Name": "init",
				"Value": [
					"mkdir -p $deployPath",
					"chmod +x $deployPath",
					"chown $os.user  $deployPath"
				],
				"From": "params.init",
				"When": "",
				"Else": null,
				"Persist": false,
				"Required": true,
				"Replace": null
			},
			{
				"Name": "commands",
				"Value": [],
				"From": "params.commands",
				"When": "",
				"Else": null,
				"Persist": false,
				"Required": true,
				"Replace": null
			},
			{
				"Name": "target",
				"Value": null,
				"From": "params.target",
				"When": "$in.params.target:!/$/ \u0026\u0026 $in.params.target",
				"Else": {
					"Credentials": "localhost",
					"URL": "ssh://127.0.0.1/"
				},
				"Persist": false,
				"Required": false,
				"Replace": null
			},
			{
				"Name": "superUser",
				"Value": false,
				"From": "",
				"When": "",
				"Else": null,
				"Persist": false,
				"Required": true,
				"Replace": null
			},
			{
				"Name": "replace",
				"Value": {},
				"From": "params.replace",
				"When": "",
				"Else": null,
				"Persist": false,
				"Required": true,
				"Replace": null
			},
			{
				"Name": "expand",
				"Value": true,
				"From": "params.expand",
				"When": "",
				"Else": null,
				"Persist": false,
				"Required": true,
				"Replace": null
			},
			{
				"Name": "startCmd",
				"Value": "",
				"From": "params.startCmd",
				"When": "",
				"Else": null,
				"Persist": false,
				"Required": false,
				"Replace": null
			}
		],
		"Post": null,
		"Tasks": [
			{
				"When": "",
				"Seq": 0,
				"Name": "build",
				"Description": "Run an action",
				"Actions": [
					{
						"Service": "exec",
						"Action": "run",
						"Request": {
							"commands": "$init",
							"superUser": true,
							"target": "$appTarget",
							"timeoutMs": 40000
						},
						"Description": "init process",
						"Tag": "Build",
						"TagIndex": "",
						"TagID": "deploy_Build",
						"TagDescription": "",
						"Extraction": null,
						"Variables": null,
						"Repeat": 1,
						"SleepTimeMs": 0,
						"Exit": "",
						"Name": "",
						"Init": null,
						"Post": null,
						"Async": false,
						"When": "$Length($init) \u003e 0",
						"Skip": ""
					},
					{
						"Service": "storage",
						"Action": "copy",
						"Request": {
							"assets": "$upload",
							"dest": "$appTarget",
							"expand": "$expand",
							"replace": "$replace",
							"source": "$target"
						},
						"Description": "upload custom assets",
						"Tag": "Build",
						"TagIndex": "",
						"TagID": "deploy_Build",
						"TagDescription": "",
						"Extraction": null,
						"Variables": null,
						"Repeat": 1,
						"SleepTimeMs": 0,
						"Exit": "",
						"Name": "",
						"Init": null,
						"Post": null,
						"Async": false,
						"When": "$Length($upload) \u003e 0",
						"Skip": ""
					},
					{
						"Service": "exec",
						"Action": "run",
						"Request": {
							"commands": "$commands",
							"errors": [
								"Error",
								"command not found",
								"No such file or directory"
							],
							"superUser": "$superUser",
							"target": "$appTarget",
							"timeoutMs": 60000
						},
						"Description": "run commands",
						"Tag": "Build",
						"TagIndex": "",
						"TagID": "deploy_Build",
						"TagDescription": "",
						"Extraction": null,
						"Variables": null,
						"Repeat": 1,
						"SleepTimeMs": 0,
						"Exit": "",
						"Name": "",
						"Init": null,
						"Post": null,
						"Async": false,
						"When": "$Length($commands) \u003e 0",
						"Skip": ""
					}
				],
				"Init": null,
				"Post": null,
				"TimeSpentMs": 0
			},
			{
				"When": "",
				"Seq": 0,
				"Name": "stop",
				"Description": "stop app",
				"Actions": [
					{
						"Service": "process",
						"Action": "stop",
						"Request": {
							"input": "${app}",
							"target": "$appTarget"
						},
						"Description": "stop app",
						"Tag": "Stop",
						"TagIndex": "",
						"TagID": "deploy_Stop",
						"TagDescription": "",
						"Extraction": null,
						"Variables": null,
						"Repeat": 1,
						"SleepTimeMs": 0,
						"Exit": "",
						"Name": "",
						"Init": null,
						"Post": null,
						"Async": false,
						"When": "",
						"Skip": ""
					}
				],
				"Init": null,
				"Post": null,
				"TimeSpentMs": 0
			},
			{
				"When": "",
				"Seq": 0,
				"Name": "start",
				"Description": "start app",
				"Actions": [
					{
						"Service": "process",
						"Action": "start",
						"Request": {
							"arguments": "$startArgs",
							"command": "$startCmd",
							"directory": "$appPath",
							"immuneToHangups": true,
							"target": "$appTarget"
						},
						"Description": "start app",
						"Tag": "Start",
						"TagIndex": "",
						"TagID": "deploy_Start",
						"TagDescription": "",
						"Extraction": null,
						"Variables": null,
						"Repeat": 1,
						"SleepTimeMs": 0,
						"Exit": "",
						"Name": "",
						"Init": null,
						"Post": null,
						"Async": false,
						"When": "$startCmd",
						"Skip": ""
					}
				],
				"Init": null,
				"Post": null,
				"TimeSpentMs": 0
			}
		],
		"OnErrorTask": "",
		"DeferTask": "",
		"SleepTimeMs": 0
	}
}