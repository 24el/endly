{
	"Workflow": {
		"Source": {
			"URL": "mem://github.com/viant/endly/workflow/service/aerospike/aerospike.csv",
			"Credentials": "",
			"Cache": "",
			"CacheExpiryMs": 0
		},
		"Data": null,
		"Name": "aerospike",
		"Description": "aeropsike docker service",
		"Init": [
			{
				"Name": "name",
				"Value": null,
				"From": "params.name",
				"When": "",
				"Else": null,
				"Persist": false,
				"Required": false,
				"Replace": null
			},
			{
				"Name": "name",
				"Value": "aerospike_endly",
				"From": "",
				"When": "$in.params.name:/$/",
				"Else": null,
				"Persist": false,
				"Required": false,
				"Replace": null
			},
			{
				"Name": "target",
				"Value": null,
				"From": "params.target",
				"When": "",
				"Else": null,
				"Persist": false,
				"Required": false,
				"Replace": null
			},
			{
				"Name": "target",
				"Value": {
					"Credentials": "localhost",
					"URL": "ssh://127.0.0.1/"
				},
				"From": "",
				"When": "$in.params.target:/$/",
				"Else": null,
				"Persist": false,
				"Required": false,
				"Replace": null
			},
			{
				"Name": "environment",
				"Value": {},
				"From": "params.environment",
				"When": "",
				"Else": null,
				"Persist": false,
				"Required": true,
				"Replace": null
			},
			{
				"Name": "environment",
				"Value": {},
				"From": "",
				"When": "$in.params.environment:/$/",
				"Else": null,
				"Persist": false,
				"Required": false,
				"Replace": null
			},
			{
				"Name": "serviceTarget",
				"Value": null,
				"From": "params.serviceTarget",
				"When": "",
				"Else": null,
				"Persist": false,
				"Required": false,
				"Replace": null
			},
			{
				"Name": "serviceTarget",
				"Value": "$target",
				"From": "",
				"When": "$in.params.serviceTarget:/$/",
				"Else": null,
				"Persist": false,
				"Required": false,
				"Replace": null
			},
			{
				"Name": "version",
				"Value": null,
				"From": "params.version",
				"When": "",
				"Else": null,
				"Persist": false,
				"Required": false,
				"Replace": null
			},
			{
				"Name": "version",
				"Value": "latest",
				"From": "",
				"When": "$in.params.version:/$/",
				"Else": null,
				"Persist": false,
				"Required": false,
				"Replace": null
			},
			{
				"Name": "image",
				"Value": null,
				"From": "params.image",
				"When": "",
				"Else": null,
				"Persist": false,
				"Required": false,
				"Replace": null
			},
			{
				"Name": "image",
				"Value": "aerospike/aerospike-server:$version",
				"From": "",
				"When": "$in.params.image:/$/",
				"Else": null,
				"Persist": false,
				"Required": false,
				"Replace": null
			},
			{
				"Name": "config",
				"Value": null,
				"From": "params.config",
				"When": "",
				"Else": null,
				"Persist": false,
				"Required": false,
				"Replace": null
			},
			{
				"Name": "hasConfig",
				"Value": "1",
				"From": "",
				"When": "$out.config:!/$/ \u0026\u0026 $out.config",
				"Else": "0",
				"Persist": false,
				"Required": false,
				"Replace": null
			},
			{
				"Name": "serviceConfig",
				"Value": "/tmp/${name}.conf",
				"From": "",
				"When": "",
				"Else": null,
				"Persist": false,
				"Required": false,
				"Replace": null
			}
		],
		"Post": null,
		"Tasks": [
			{
				"When": "",
				"Seq": 0,
				"Name": "start",
				"Description": "start aerospike service",
				"Actions": [
					{
						"Service": "storage",
						"Action": "copy",
						"Request": {
							"assets": [
								{
									"Key": "$config",
									"Value": "$serviceConfig"
								}
							],
							"dest": "$serviceTarget",
							"source": "$target"
						},
						"Description": "copy config file to temp location",
						"Tag": "Start",
						"TagIndex": "",
						"TagID": "aerospike_Start",
						"TagDescription": "",
						"Extraction": null,
						"Variables": null,
						"Repeat": 1,
						"SleepTimeMs": 0,
						"Exit": "",
						"Name": "",
						"Init": null,
						"Post": null,
						"Async": false,
						"When": "$hasConfig:1",
						"Skip": ""
					},
					{
						"Service": "workflow",
						"Action": "switch",
						"Request": {
							"Cases": [
								{
									"Action": "run",
									"Description": "run aerospike $name with custom config",
									"Request": {
										"env": "$environment",
										"image": "$image",
										"mount": [
											{
												"Key": "${serviceConfig}",
												"Value": "/opt/aerospike/etc/aerospike.conf"
											}
										],
										"name": "$name",
										"params": [
											{
												"Key": "--config-file",
												"Value": "/opt/aerospike/etc/aerospike.conf"
											}
										],
										"ports": [
											{
												"Key": "3000",
												"Value": "3000"
											},
											{
												"Key": "3001",
												"Value": "3001"
											},
											{
												"Key": "3002",
												"Value": "3002"
											},
											{
												"Key": "3004",
												"Value": "3004"
											},
											{
												"Key": "8081",
												"Value": "8081"
											}
										],
										"target": "$serviceTarget"
									},
									"Service": "docker",
									"Tag": "RunCase",
									"TagID": "aerospike_RunCase",
									"Value": "1"
								},
								{
									"Action": "run",
									"Description": "run aerospike $name with default config",
									"Request": {
										"env": "$environment",
										"image": "$image",
										"name": "$name",
										"ports": [
											{
												"Key": "3000",
												"Value": "3000"
											},
											{
												"Key": "3001",
												"Value": "3001"
											},
											{
												"Key": "3002",
												"Value": "3002"
											},
											{
												"Key": "3004",
												"Value": "3004"
											},
											{
												"Key": "8081",
												"Value": "8081"
											}
										],
										"target": "$serviceTarget"
									},
									"Service": "docker",
									"Tag": "RunCase",
									"TagID": "aerospike_RunCase",
									"Value": "0"
								}
							],
							"SourceKey": "hasConfig"
						},
						"Description": "check if custom config has been supplied",
						"Tag": "Start",
						"TagIndex": "",
						"TagID": "aerospike_Start",
						"TagDescription": "",
						"Extraction": null,
						"Variables": null,
						"Repeat": 1,
						"SleepTimeMs": 0,
						"Exit": "",
						"Name": "",
						"Init": null,
						"Post": null,
						"Async": false,
						"When": "",
						"Skip": ""
					},
					{
						"Service": "dsunit",
						"Action": "register",
						"Request": {
							"config": [
								{
									"Key": "descriptor",
									"Value": "[username]:[password]@tcp(127.0.0.1:3306)/[dbname]?parseTime=true"
								},
								{
									"Key": "driverName",
									"Value": "aerospike"
								},
								{
									"Key": "descriptor",
									"Value": "tcp(127.0.0.1:3000)/[namespace]"
								},
								{
									"Key": "Parameters",
									"Value": [
										{
											"Key": "dbname",
											"Value": "mydb"
										},
										{
											"Key": "namespace",
											"Value": "test"
										},
										{
											"Key": "host",
											"Value": "127.0.0.1"
										},
										{
											"Key": "port",
											"Value": 3000
										}
									]
								}
							],
							"datastore": "testdb"
						},
						"Description": "register test db connection",
						"Tag": "Start",
						"TagIndex": "",
						"TagID": "aerospike_Start",
						"TagDescription": "",
						"Extraction": null,
						"Variables": null,
						"Repeat": 1,
						"SleepTimeMs": 0,
						"Exit": "",
						"Name": "",
						"Init": null,
						"Post": null,
						"Async": false,
						"When": "",
						"Skip": ""
					},
					{
						"Service": "workflow",
						"Action": "goto",
						"Request": {
							"task": "check"
						},
						"Description": "check if db ready",
						"Tag": "Start",
						"TagIndex": "",
						"TagID": "aerospike_Start",
						"TagDescription": "",
						"Extraction": null,
						"Variables": null,
						"Repeat": 1,
						"SleepTimeMs": 0,
						"Exit": "",
						"Name": "",
						"Init": null,
						"Post": null,
						"Async": false,
						"When": "",
						"Skip": ""
					}
				],
				"Init": null,
				"Post": null,
				"TimeSpentMs": 0
			},
			{
				"When": "",
				"Seq": 0,
				"Name": "check",
				"Description": "check if started",
				"Actions": [
					{
						"Service": "dsunit",
						"Action": "query",
						"Request": {
							"datastore": "testdb",
							"ignoreError": true,
							"sql": "SELECT id FROM dummy"
						},
						"Description": "run test query",
						"Tag": "Check",
						"TagIndex": "",
						"TagID": "aerospike_Check",
						"TagDescription": "",
						"Extraction": null,
						"Variables": null,
						"Repeat": 1,
						"SleepTimeMs": 0,
						"Exit": "",
						"Name": "",
						"Init": null,
						"Post": [
							{
								"Name": "status",
								"Value": null,
								"From": "Message",
								"When": "",
								"Else": null,
								"Persist": false,
								"Required": false,
								"Replace": null
							}
						],
						"Async": false,
						"When": "",
						"Skip": ""
					},
					{
						"Service": "workflow",
						"Action": "goto",
						"Request": {
							"task": "check"
						},
						"Description": "check if db ready",
						"Tag": "Check",
						"TagIndex": "",
						"TagID": "aerospike_Check",
						"TagDescription": "",
						"Extraction": null,
						"Variables": null,
						"Repeat": 1,
						"SleepTimeMs": 1000,
						"Exit": "",
						"Name": "",
						"Init": null,
						"Post": null,
						"Async": false,
						"When": "$status:/is not yet fully initialized/",
						"Skip": ""
					}
				],
				"Init": null,
				"Post": null,
				"TimeSpentMs": 0
			},
			{
				"When": "",
				"Seq": 0,
				"Name": "stop",
				"Description": "stop aerospike $name",
				"Actions": [
					{
						"Service": "docker",
						"Action": "stop",
						"Request": {
							"name": "$name",
							"target": "$serviceTarget"
						},
						"Description": "start aerospike $name",
						"Tag": "Stop",
						"TagIndex": "",
						"TagID": "aerospike_Stop",
						"TagDescription": "",
						"Extraction": null,
						"Variables": null,
						"Repeat": 1,
						"SleepTimeMs": 0,
						"Exit": "",
						"Name": "",
						"Init": null,
						"Post": null,
						"Async": false,
						"When": "",
						"Skip": ""
					}
				],
				"Init": null,
				"Post": null,
				"TimeSpentMs": 0
			}
		],
		"OnErrorTask": "",
		"DeferTask": "",
		"SleepTimeMs": 0
	}
}