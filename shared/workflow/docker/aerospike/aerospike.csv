Workflow,,,Name,Description,Tasks,,Init,
,,,aerospike,aeropsike docker service,%Tasks,,@var/init,
[]Tasks,,,Name,Description,Actions,When,,
,,,start,start aerospike service,%Start,,,
[]Start,,Service,Action,Description,Request,When,,
,,storage,copy,copy config file to temp location, @req/copy,$hasConfig:1,,
[]Start,,Service,Action,Description,Request.SourceKey,Request.Cases,,
,,workflow,switch,check if custom config has been supplied,hasConfig,%RunCase,,
[]RunCase,Value,Service,Action,Description,Request,,,
,1,docker,run,run aerospike $name with custom config, @req/run-with-conf,,,
,0,docker,run,run aerospike $name with default config, @req/run,,,
[]Start,,Service,Action,Description,Request,When,,
,,dsunit,register,register test db connection, @req/register,,,
,,workflow,goto,check if db ready,@req/goto_check,,,
[]Tasks,,,Name,Description,Actions,,,
,,,check,check if started,%Check,,,
[]Check,,Service,Action,Description,Request,Post,When,SleepTimeMs
,,dsunit,query,run test query, @req/query, @var/status,,
,,workflow,goto,check if db ready,@req/goto_check,,$status:/is not yet fully initialized/,1000
[]Tasks,,,Name,Description,Actions,,,
,,,stop,stop aerospike $name,%Stop,,,
[]Stop,,Service,Action,Description,Request,,,
,,docker,stop,start aerospike $name, @req/stop,,,